<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Retro Slots</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Press Start 2P', cursive;
      background-color: #00278a;
      color: #fff;
      text-align: center;
      background-image: url("https://www.transparenttextures.com/patterns/3px-tile.png");
      margin: 0;
      padding-bottom: 140px;
    }
    header {
      background-color: #173e69;
      padding: 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 1.2rem;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    header .logo {
      font-size: 1.5rem;
      letter-spacing: 2px;
      color: #ffdd00;
      transition: transform 0.5s ease-in-out;
    }
    header .logo:hover {
      transform: rotate(360deg);
    }
    nav a {
      margin-left: 2rem;
      color: #ff0000;
      text-decoration: none;
    }
    nav a:hover {
      text-decoration: underline;
    }
    h1 {
      font-size: 1.5rem;
      color: #63b3ff;
      text-shadow: 2px 2px #000;
      margin-top: 3rem;
    }
    #coins {
      font-size: 1rem;
      color: #ff0000;
      font-weight: bold;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
      margin-bottom: 2rem;
    }
    .game {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      margin-top: 4rem;
      position: relative;
    }
    img.bg {
      position: absolute;
      z-index: 1;
      top: 0;
      height: 385px;
      opacity: 0.7;
      border-radius: 30px;
      box-shadow: 0 0 20px 5px rgba(255, 223, 0, 0.9);
    }
    .slots-container {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      width: 700px;
      gap: 0px 30px;
      z-index: 5;
      margin-top: 40px;
      margin-left: 20px;
    }
    .slot {
      width: 100px;
      height: 100px;
      background-color: #26055242;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .slot img {
      width: 80px;
      height: 80px;
      object-fit: contain;
    }
    .controls {
      margin-top: 50px;
      width: 320px;
      z-index: 10;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }
    input[type="number"] {
      font-family: 'Press Start 2P', cursive;
      width: 100px;
      padding: 0.5rem;
      font-size: 0.75rem;
      border: none;
      border-radius: 6px;
      text-align: center;
    }
    .spin-button {
      font-family: 'Arial Black', sans-serif;
      background: linear-gradient(to bottom, #FFD700, #DAA520);
      border: 2px solid #B8860B;
      border-radius: 6px;
      box-shadow: 2px 2px 5px rgba(255, 215, 0, 0.8);
      color: #000;
      padding: 1rem;
      font-size: 0.75rem;
      width: 100px;
      height: 60px;
      transition: all 0.3s ease-in-out;
      cursor: pointer;
    }
    .spin-button:hover {
      background: linear-gradient(to bottom, #FFEC8B, #FFD700);
      box-shadow: 0 0 20px 5px rgba(255, 223, 0, 0.9);
    }
    #result {
      font-size: 1rem;
      margin-top: 1rem;
    }
    footer {
      background-color: #173e69;
      color: #ffffff;
      padding: 1rem;
      position: fixed;
      bottom: 0;
      width: 100%;
      font-size: 0.8rem;
      z-index: 200;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">RETRO CASINO</div>
    <nav>
      <a href="cw.html">HOME</a>
      <a href="about.html">ABOUT</a>
      <a href="help.html">HELP</a>
    </nav>
  </header>

  <h1>SLOTS MACHINE</h1>
  <div id="coins">COINS: 0</div>

  <div class="game">
    <img class="bg" src="slotmachin.png" alt="Slot Machine Background" />
    <div class="slots-container">
      <!-- 15 slots -->
      <div id="slot1" class="slot"></div>
      <div id="slot2" class="slot"></div>
      <div id="slot3" class="slot"></div>
      <div id="slot4" class="slot"></div>
      <div id="slot5" class="slot"></div>
      <div id="slot6" class="slot"></div>
      <div id="slot7" class="slot"></div>
      <div id="slot8" class="slot"></div>
      <div id="slot9" class="slot"></div>
      <div id="slot10" class="slot"></div>
      <div id="slot11" class="slot"></div>
      <div id="slot12" class="slot"></div>
      <div id="slot13" class="slot"></div>
      <div id="slot14" class="slot"></div>
      <div id="slot15" class="slot"></div>
    </div>

    <div class="controls">
      <input type="number" id="bet-amount" min="1" placeholder="Enter bet" />
      <div style="display: flex; gap: 0.5rem;">
        <button class="spin-button" onclick="oneliner()">1 LINE</button>
        <button class="spin-button" onclick="threeliner()">3 LINE</button>
        <button class="spin-button" onclick="fiveliner()">5 LINE</button>
      </div>
      <div id="result"></div>
    </div>
  </div>

  <audio id="spin-sound" src="rename.mp3"></audio>
  <audio id="win-sound" src="win.mp3"></audio>

  <footer>
    <p>&copy; 2025 Retro Slots. All rights reserved.</p>
    <p>Developed by <a href="https://github.com/tooneek">Tooneek</a></p>
  </footer>

  <script>
    const symbols = [
      { name: 'slot 9', img: 'slot 9.png', multiplier: 200 },
      { name: 'slot 10', img: 'slot 10.png', multiplier: 300 },
      { name: 'slot a', img: 'slot a.png', multiplier: 150 },
      { name: 'slot fish', img: 'slot fish.png', multiplier: 400 },
      { name: 'slot in and yan', img: 'slot in and yan.png', multiplier: 250 },
      { name: 'slot j', img: 'slot j.png', multiplier: 100 },
      { name: 'slot k', img: 'slot k.png', multiplier: 120 },
      { name: 'slot king', img: 'slot king.png', multiplier: 500 },
      { name: 'slot lamp', img: 'slot lamp.png', multiplier: 300 },
      { name: 'slot ornage', img: 'slot ornage.png', multiplier: 180 },
      { name: 'slot q', img: 'slot q.png', multiplier: 130 }
    ];

    let coins = 0;

    function updateCoinsDisplay() {
      document.getElementById('coins').textContent = `COINS: ${coins}`;
    }

    function saveCoins() {
      const userId = localStorage.getItem('currentUserId');
      if (!userId) return;

      const userDataRaw = localStorage.getItem(userId);
      if (!userDataRaw) return;

      const user = JSON.parse(userDataRaw);
      user.coins = coins;
      localStorage.setItem(userId, JSON.stringify(user));
    }

    function renderSlot(id, symbol) {
      const slot = document.getElementById(id);
      slot.innerHTML = '';
      const img = document.createElement('img');
      img.src = symbol.img;
      img.alt = symbol.name;
      slot.appendChild(img);
    }

    function spin(callback) {
      const finalSymbols = [];
      const slotIds = Array.from({ length: 15 }, (_, i) => `slot${i + 1}`);

      slotIds.forEach((id, index) => {
        let spins = 10 + Math.floor(Math.random() * 10);
        let count = 0;

        const spinInterval = setInterval(() => {
          const symbol = symbols[Math.floor(Math.random() * symbols.length)];
          renderSlot(id, symbol);
          count++;

          if (count >= spins) {
            clearInterval(spinInterval);
            finalSymbols[index] = symbol;

            if (finalSymbols.filter(Boolean).length === 15) {
              callback(finalSymbols);
            }
          }
        }, 80);
      });
    }

    function oneliner() {
      const bet = parseInt(document.getElementById('bet-amount').value);
      const result = document.getElementById('result');

      if (isNaN(bet) || bet <= 0) {
        result.textContent = "Enter a valid bet amount!";
        return;
      }
      if (coins < bet) {
        result.textContent = "Not enough coins!";
        return;
      }

      coins -= bet;
      updateCoinsDisplay();
      saveCoins();
      result.textContent = "";

      document.getElementById('spin-sound').play();

      spin((s) => {
        const [a, b, c, d, e] = [s[5], s[6], s[7], s[8], s[9]];
        if (
          a.name === b.name &&
          b.name === c.name &&
          c.name === d.name &&
          d.name === e.name
        ) {
          const win = bet * a.multiplier;
          coins += win;
          result.textContent = `ðŸŽ‰ JACKPOT! YOU WIN ${win} COINS (Middle Line)! âœ¨`;
          document.getElementById('win-sound').play();
        } else {
          result.textContent = "You lost on 1 line!";
        }
        updateCoinsDisplay();
        saveCoins();
      });
    }

    function threeliner() {
      const bet = parseInt(document.getElementById('bet-amount').value);
      const result = document.getElementById('result');
      const totalBet = bet * 3;

      if (isNaN(bet) || bet <= 0) {
        result.textContent = "Enter a valid bet amount!";
        return;
      }
      if (coins < totalBet) {
        result.textContent = "Not enough coins!";
        return;
      }

      coins -= totalBet;
      updateCoinsDisplay();
      saveCoins();
      result.textContent = "";

      document.getElementById('spin-sound').play();

      spin((s) => {
        let win = 0;
        const line1 = [s[0], s[1], s[2], s[3], s[4]];
        const line2 = [s[5], s[6], s[7], s[8], s[9]];
        const line3 = [s[10], s[11], s[12], s[13], s[14]];

        if (line1.every(x => x.name === line1[0].name)) win += bet * line1[0].multiplier;
        if (line2.every(x => x.name === line2[0].name)) win += bet * line2[0].multiplier;
        if (line3.every(x => x.name === line3[0].name)) win += bet * line3[0].multiplier;

        if (win) {
          result.textContent = `ðŸŽ‰ YOU WIN ${win} COINS (3 LINES)! âœ¨`;
          document.getElementById('win-sound').play();
        } else {
          result.textContent = "You lost on 3 lines!";
        }
        coins += win;
        updateCoinsDisplay();
        saveCoins();
      });
    }

    function fiveliner() {
      const bet = parseInt(document.getElementById('bet-amount').value);
      const result = document.getElementById('result');
      const totalBet = bet * 5;

      if (isNaN(bet) || bet <= 0) {
        result.textContent = "Enter a valid bet amount!";
        return;
      }
      if (coins < totalBet) {
        result.textContent = "Not enough coins!";
        return;
      }

      coins -= totalBet;
      updateCoinsDisplay();
      saveCoins();
      result.textContent = "";

      document.getElementById('spin-sound').play();

      spin((s) => {
        let win = 0;
        const lines = [
          [s[0], s[1], s[2], s[3], s[4]],
          [s[5], s[6], s[7], s[8], s[9]],
          [s[10], s[11], s[12], s[13], s[14]],
          [s[0], s[6], s[12], s[8], s[4]],
          [s[14], s[8], s[2], s[6], s[10]],
        ];

        lines.forEach(line => {
          if (line.every(x => x.name === line[0].name)) {
            win += bet * line[0].multiplier;
          }
        });

        result.textContent = win
          ? `ðŸŽ‰ YOU WIN ${win} COINS (5 LINES)! âœ¨`
          : "You lost on 5 lines!";

        coins += win;
        updateCoinsDisplay();
        saveCoins();
      });
    }

    // On page load, load coins and check login
    (function () {
      const userId = localStorage.getItem('currentUserId');
      if (!userId) {
        window.location.href = 'login.html';
        return;
      }

      const userDataRaw = localStorage.getItem(userId);
      if (!userDataRaw) {
        localStorage.removeItem('currentUserId');
        window.location.href = 'login.html';
        return;
      }

      window.currentUser = JSON.parse(userDataRaw);
      coins = window.currentUser.coins || 0;

      if (coins <= 0) {
        alert("You have 0 coins and cannot play this game.");
        // Optional: disable play buttons here
      }

      updateCoinsDisplay();
    })();
  </script>
</body>
</html>
